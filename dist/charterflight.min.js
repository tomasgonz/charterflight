/*! charterflight 2015-07-13 */
function getMinOfArray(a){return Math.min.apply(null,a)}function getMaxOfArray(a){return Math.max.apply(null,a)}!function(a){var b={version:"0.1"};if(a.charterflight)throw new Error("Charterflight has already been defined");a.charterflight=b}("undefined"==typeof window?this:window),charterflight.Blurb=function(){this.Data=null,this.BlurbPlaceHolder=""},charterflight.Blurb.prototype.Draw=function(){var a=this.Data.key,b=[],c=[];this.Data.values.forEach(function(a){b.push(a.date.getFullYear()),c.push(a.value)}),minValue=getMinOfArray(c),maxValue=getMaxOfArray(c);var d="<h2>"+a+"</h2>";d+="Min value:"+minValue+" max value: "+maxValue,d+="<p>",d+="</p>",$(this.BlurbPlaceHolder).html(d)},charterflight.BarChart=function(){this.ShowLegend=!1,this.Width=200,this.Height=200,this.svg=null,this.Margin={top:20,right:20,bottom:20,left:20},this.BlurbPlaceHolder="",this.ChartPlaceHolder="",this.Data=null},charterflight.BarChart.prototype.Draw=function(){this.svg=null,width=this.Width-this.Margin.left-this.Margin.right,height=this.Height-this.Margin.top-this.Margin.bottom,data=data.map(function(a){return{country:a.country,value:+a.value}});var a=d3.scale.linear().range([height,0]),b=d3.scale.ordinal().rangeRoundBands([0,width],.1).domain(d3.entries(data).map(function(a){return a.value.country}));a.domain([d3.min(data,function(a){return a.value}),d3.max(data,function(a){return a.value})]);var c=d3.svg.axis().scale(b).orient("bottom"),d=d3.svg.axis().scale(a).orient("left"),e=d3.select(this.ChartPlaceHolder).append("svg").attr("width",this.Width+this.Margin.left+this.Margin.right).attr("height",this.Height+this.Margin.top+this.Margin.bottom).append("g").attr("transform","translate("+this.Margin.left+","+this.Margin.top+")");return e.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(c),e.append("g").attr("class","y axis").call(d).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end"),e.selectAll(".bar").data(data).enter().append("rect").attr("class","bar").attr("x",function(a){return b(a.country)}).attr("width",b.rangeBand()).attr("y",function(b){return a(b.value)}).attr("height",function(b){return height-a(b.value)}).style("fill","#1684ca"),e.selectAll(".x.axis text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(a){return"rotate(-90)"}),e},charterflight.LineChart=function(){this.Width=200,this.Height=200,this.svg=null,this.Margin={top:20,right:20,bottom:20,left:20},this.LegendPlaceHolder="",this.BlurbPlaceHolder="",this.ChartPlaceHolder="",this.Data=null},charterflight.LineChart.prototype.Draw=function(){var a=this;width=this.Width-this.Margin.left-this.Margin.right,height=this.Height-this.Margin.top-this.Margin.bottom;var c=d3.time.format("%Y").parse;data=this.Data.map(function(a){return{country:a.country,date:c(a.date),value:+a.value}}),data=d3.nest().key(function(a){return a.country}).entries(data);var d=[];data.forEach(function(a){d.push(a.key)});var e=d3.time.scale().range([0,width]),f=d3.scale.linear().range([height,0]),g=d3.scale.category10(),h=d3.svg.axis().scale(e).orient("bottom"),i=d3.svg.axis().scale(f).orient("left"),j=d3.svg.line().interpolate("basis").x(function(a){return e(a.date)}).y(function(a){return f(a.value)}).defined(function(a){return a.value}),k=d3.select(this.ChartPlaceHolder).append("svg").attr("width",width+this.Margin.left+this.Margin.right).attr("height",height+this.Margin.top+this.Margin.bottom).append("g").attr("transform","translate("+this.Margin.left+","+this.Margin.top+")");g.domain(d3.keys(data[0]).filter(function(a){return"country"==a})),g.domain(d),e.domain([d3.min(data,function(a){return d3.min(a.values,function(a){return a.date})}),d3.max(data,function(a){return d3.max(a.values,function(a){return a.date})})]),f.domain([d3.min(data,function(a){return d3.min(a.values,function(a){return a.value})}),d3.max(data,function(a){return d3.max(a.values,function(a){return a.value})})]),k.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(h),k.append("g").attr("class","y axis").call(i);var l=k.selectAll(".country").data(data,function(a){return a.key}).enter().append("g").attr("class","country"),m=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);l.append("svg:path").attr("class","line").attr("id",function(c){return""!==a.LegendPlaceHolder&&($(a.LegendPlaceHolder).append('<div class="legend-item" id="legend-'+c.key.sanitize()+'" style="color:'+g(c.key)+'">'+c.key+"</div>"),d3.select("#legend-"+c.key.sanitize()).on("mouseover",function(){var d=d3.select("#"+c.key.sanitize()).attr("class");d3.select("#"+c.key.sanitize()).attr("class",d+" current"),d=d3.select("#legend-"+c.key.sanitize()).attr("class"),d3.select("#legend-"+c.key.sanitize()).style("background-color",g(c.key)),d3.select("#legend-"+c.key.sanitize()).style("color","#fff"),""!==a.BlurbPlaceHolder&&(b=new charterflight.Blurb,b.BlurbPlaceHolder=a.BlurbPlaceHolder,b.Data=c,b.Draw())}),d3.select("#legend-"+c.key.sanitize()).on("mouseout",function(){var a=d3.select("#"+c.key.sanitize()).attr("class"),b=a.substring(0,a.length-8);d3.select("#"+c.key.sanitize()).attr("class",b),a=d3.select("#legend-"+c.key.sanitize()).attr("class"),b=a.substring(0,a.length-14),d3.select("#legend-"+c.key.sanitize()).style("background-color","#fff"),d3.select("#legend-"+c.key.sanitize()).style("color",g(c.key))})),c.key.sanitize()}).attr("d",function(a){return j(a.values)}).on("mouseover",function(c){var d=d3.select("#"+c.key.sanitize()).attr("class");d3.select("#"+c.key.sanitize()).attr("class",d+" current"),""!==a.LegendPlaceHolder&&(d=d3.select("#legend-"+c.key.sanitize()).attr("class"),d3.select("#legend-"+c.key.sanitize()).style("background-color",g(c.key)),d3.select("#legend-"+c.key.sanitize()).style("color","#fff")),""!==a.BlurbPlaceHolder&&(b=new charterflight.Blurb,b.BlurbPlaceHolder=a.BlurbPlaceHolder,b.Data=c,b.Draw())}).on("mouseout",function(b){var c=d3.select("#"+b.key.sanitize()).attr("class"),d=c.substring(0,c.length-8);d3.select("#"+b.key.sanitize()).attr("class",d),""!==a.LegendPlaceHolder&&(c=d3.select("#legend-"+b.key.sanitize()).attr("class"),d=c.substring(0,c.length-14),d3.select("#legend-"+b.key.sanitize()).style("background-color","#fff"),d3.select("#legend-"+b.key.sanitize()).style("color",g(b.key)))}).style("stroke",function(a){return g(a.key)}),l.append("g").selectAll("circle").data(function(a){return a.values}).enter().append("circle").attr("r",3).attr("cx",function(a){return e(a.date)}).attr("cy",function(a){return f(a.value)}).style("fill",function(a){return g(a.country)}).attr("stroke","none").on("mouseover",function(a){m.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px"),m.transition().duration(100).style("opacity",100),m.html("<p>Country: "+a.country+"<br />Date: "+a.date.getFullYear()+"<br/>Value: "+a.value+"</p>")}).on("mouseout",function(a){m.transition().duration(4e3).style("opacity",0)}),""!==this.LegendPlaceHolder,this.svg=k},String.prototype.replaceAll=function(a,b){return this.replace(new RegExp(a,"g"),b)},String.prototype.sanitize=function(){var a=this.replaceAll(" ","_");return a=a.replaceAll(",","")};