/*! charterflight 2015-06-26 */
!function(a){var b={version:"1.0"};if(a.charterflight)throw new Error("Charterflight has alread been defined");a.charterflight=b}("undefined"==typeof window?this:window),charterflight.LineChart=function(){this.ShowLegend=!1,this.Width=200,this.Height=200,this.svg=null,this.Margin={top:20,right:20,bottom:20,left:20},this.BlurbPlaceHolder=null,this.ChartPlaceHolder="",this.Data=null},charterflight.LineChart.prototype.Draw=function(){width=this.Width-this.Margin.left-this.Margin.right,height=this.Height-this.Margin.top-this.Margin.bottom;var a=d3.time.format("%Y").parse;data=this.Data.map(function(b){return{country:b.country,date:a(b.date),value:+b.value}}),data=d3.nest().key(function(a){return a.country}).entries(data);var b=[];data.forEach(function(a){b.push(a.key)});var c=d3.time.scale().range([0,width]),d=d3.scale.linear().range([height,0]),e=d3.scale.category10(),f=d3.svg.axis().scale(c).orient("bottom"),g=d3.svg.axis().scale(d).orient("left"),h=d3.svg.line().interpolate("basis").x(function(a){return c(a.date)}).y(function(a){return d(a.value)}).defined(function(a){return a.value}),i=d3.select(this.ChartPlaceHolder).append("svg").attr("width",width+this.Margin.left+this.Margin.right).attr("height",height+this.Margin.top+this.Margin.bottom).append("g").attr("transform","translate("+this.Margin.left+","+this.Margin.top+")");e.domain(d3.keys(data[0]).filter(function(a){return"country"==a})),e.domain(b),c.domain([d3.min(data,function(a){return d3.min(a.values,function(a){return a.date})}),d3.max(data,function(a){return d3.max(a.values,function(a){return a.date})})]),d.domain([d3.min(data,function(a){return d3.min(a.values,function(a){return a.value})}),d3.max(data,function(a){return d3.max(a.values,function(a){return a.value})})]),i.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(f),i.append("g").attr("class","y axis").call(g);var j=i.selectAll(".country").data(data,function(a){return a.key}).enter().append("g").attr("class","country"),k=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);if(j.append("svg:path").attr("class","line").attr("id",function(a){return a.key}).attr("d",function(a){return h(a.values)}).on("mouseover",function(){null!=this.BlurbPlaceHolder&&Blurb()}).on("mouseout",onmouseout).style("stroke",function(a){return e(a.key)}),j.append("g").selectAll("circle").data(function(a){return a.values}).enter().append("circle").attr("r",3).attr("cx",function(a){return c(a.date)}).attr("cy",function(a){return d(a.value)}).style("fill",function(a){return e(a.country)}).attr("stroke","none").on("mouseover",function(a){k.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px"),k.transition().duration(100).style("opacity",100),k.html("<p>Country: "+a.country+"<br />Date: "+a.date.getFullYear()+"<br/>Value: "+a.value+"</p>")}).on("mouseout",function(a){k.transition().duration(4e3).style("opacity",0)}),1==this.ShowLegend){var l=i.selectAll(".legend").data(b.slice().reverse()).enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(55,"+20*b+")"}).on("mouseover",function(a,b){var c=d3.select("#"+a).attr("class");d3.select("#"+a).attr("class",c+" current")}).on("mouseout",function(a,b){var c=d3.select("#"+a).attr("class"),d=c.substring(0,c.length-8);d3.select("#"+a).attr("class",d)});l.append("text").attr("x",width+20).attr("y",6).attr("dy",".35em").style("text-anchor","end").style("fill",e).text(function(a){return a}).on("mouseover",function(a,b){var c=d3.select("#"+a).attr("class");d3.select(this).attr("class",c+" current-legend")}).on("mouseout",function(a,b){var c=d3.select(this).attr("class"),d=c.substring(0,c.length-14);d3.select(this).attr("class",d)})}this.svg=i},charterflight.LineChart.prototype.Blurb=function(){var a=d3.select(this).attr("class");d3.select(this).attr("class",a+" current");var b=d.key;years=[],values=[],d.values.forEach(function(a){years.push(a.date.getFullYear()),values.push(a.value)}),minValue=getMinOfArray(values),maxValue=getMaxOfArray(values);var c="<h2>"+b+"</h2>";c+="Min value:"+minValue+" max value: "+maxValue,c+="<p>",c+="</p>",$("#blurb-content").html(c)};